<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Quiz Player</title>
    <style>
        :root {
            --primary-bg: #f4f7f9;
            --secondary-bg: #ffffff;
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --accent-color: #3498db;
            --accent-hover: #2980b9;
            --correct-color: #2ecc71;
            --incorrect-color: #e74c3c;
            --border-color: #dfe6e9;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --border-radius: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--secondary-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .view {
            padding: 30px;
            display: none; /* Hidden by default */
        }

        .view.active {
            display: block;
        }

        h1, h2 {
            text-align: center;
            margin-top: 0;
            color: var(--primary-text);
        }
        
        h2 {
            font-size: 1.5em;
            margin-bottom: 25px;
        }

        p, label {
            line-height: 1.6;
            color: var(--primary-text);
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .button:hover {
            background-color: var(--accent-hover);
        }
        
        .button.secondary {
            background-color: #bdc3c7;
        }
        
        .button.secondary:hover {
             background-color: #95a5a6;
        }

        .button.danger {
            background-color: var(--incorrect-color);
        }
        
        .button.danger:hover {
            background-color: #c0392b;
        }
        
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #module-selection-form label {
            display: block;
            background-color: var(--primary-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #module-selection-form label:hover {
            background-color: #e8eced;
        }
        
        #module-selection-form input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        #quiz-progress {
            text-align: center;
            font-weight: 600;
            color: var(--secondary-text);
            margin-bottom: 20px;
        }

        #question-text {
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 25px;
        }
        
        #answer-options {
            display: grid;
            gap: 10px;
        }
        
        .option-btn {
            width: 100%;
            text-align: left;
            padding: 15px;
            background-color: var(--secondary-bg);
            border: 2px solid var(--border-color);
            color: var(--primary-text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-btn:not(:disabled):hover {
            border-color: var(--accent-color);
            background-color: #eaf5fc;
        }
        
        .option-btn.correct {
            background-color: var(--correct-color);
            border-color: var(--correct-color);
            color: white;
            font-weight: 600;
        }
        
        .option-btn.incorrect {
            background-color: var(--incorrect-color);
            border-color: var(--incorrect-color);
            color: white;
            font-weight: 600;
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }
        
        #explanation-text {
            margin-top: 25px;
            padding: 15px;
            background-color: var(--primary-bg);
            border-left: 4px solid var(--accent-color);
            border-radius: 4px;
            display: none; /* Hidden until an answer is given */
        }
        
        #explanation-text p {
             margin: 0;
        }
        
        #quiz-summary-view {
            text-align: center;
        }

        #final-score {
            font-size: 1.8em;
            font-weight: 600;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="module-selection-view" class="view">
            <h2>Select Modules for Your Quiz</h2>
            <div id="module-selection-form"></div>
            <div class="button-group">
                <button id="start-quiz-btn" class="button" disabled>Start Quiz</button>
            </div>
        </div>

        <div id="active-quiz-view" class="view">
            <div id="quiz-progress"></div>
            <div id="question-text"></div>
            <div id="answer-options"></div>
            <div id="explanation-text"></div>
            <div class="button-group">
                <button id="skip-question-btn" class="button secondary">Skip Question</button>
                <button id="exit-quiz-btn" class="button danger">Exit Quiz</button>
            </div>
        </div>

        <div id="quiz-summary-view" class="view">
            <h2>Quiz Complete!</h2>
            <p>Your final score is:</p>
            <div id="final-score"></div>
            <div class="button-group">
                <button id="return-to-menu-btn" class="button">Back to Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        // ######################################################################
        // ######################################################################
        //
        //          THIS IS THE ONLY PLACE YOU NEED TO EDIT THE EXAM
        //
        //  - Delete the example modules below.
        //  - Add your own by following the same format.
        //  - Make sure each module has a unique key (e.g., "Quiz_Module_1").
        //  - Ensure commas are correct between modules.
        //
        //  --- Template for a new module ---
        //
        //  "Your_Unique_Module_ID": {
        //      "moduleName": "The Name Students Will See",
        //      "questionBank": [
        //          {
        //              "topic": "A_Unique_Topic_ID",
        //              "question": "Your question text here?",
        //              "options": ["Option A", "Option B", "Option C", "Option D"],
        //              "correctAnswer": 0 // 0 is A, 1 is B, 2 is C, 3 is D
        //          }
        //      ],
        //      "topicTextMap": {
        //          "A_Unique_Topic_ID": "The explanation text for the topic goes here."
        //      }
        //  },
        //
        // ######################################################################
        // ######################################################################

        const quizData = {
            "Quiz_Module_1": {
                "moduleName": "Basic Anatomy: The Heart",
                "questionBank": [
                    {
                        "topic": "FourChambers",
                        "question": "How many chambers does the human heart have?",
                        "options": ["One", "Two", "Three", "Four"],
                        "correctAnswer": 3
                    },
                    {
                        "topic": "AortaFunction",
                        "question": "What is the primary function of the aorta?",
                        "options": [
                            "To carry deoxygenated blood to the lungs",
                            "To carry oxygenated blood to the rest of the body",
                            "To receive blood from the body",
                            "To pump blood to the ventricles"
                        ],
                        "correctAnswer": 1
                    }
                ],
                "topicTextMap": {
                    "FourChambers": "The human heart is a four-chambered muscular organ. The four chambers are the right atrium, the left atrium, the right ventricle, and the left ventricle.",
                    "AortaFunction": "The aorta is the largest artery in the body. Its primary function is to carry oxygenated blood from the left ventricle to the rest of the body through systemic circulation."
                }
            },
            "Quiz_Module_2": {
                "moduleName": "Pharmacology 101",
                "questionBank": [
                    {
                        "topic": "AspirinClass",
                        "question": "To which class of drugs does Aspirin belong?",
                        "options": ["Antibiotic", "NSAID", "Antiviral", "Opioid"],
                        "correctAnswer": 1
                    },
                    {
                        "topic": "HalfLife",
                        "question": "What does the term 'half-life' refer to in pharmacology?",
                        "options": [
                            "The time it takes for a drug to show its effect",
                            "The time it takes for half of the drug dose to be eliminated from the body",
                            "The duration of the drug's patent",
                            "Half the maximum effective dose"
                        ],
                        "correctAnswer": 1
                    }
                ],
                "topicTextMap": {
                    "AspirinClass": "Aspirin, or acetylsalicylic acid, is a nonsteroidal anti-inflammatory drug (NSAID). It is used to reduce pain, fever, and/or inflammation, and as an antiplatelet agent.",
                    "HalfLife": "The half-life of a drug is a pharmacokinetic parameter defined as the time it takes for the concentration of the drug in the plasma or the total amount in the body to be reduced by 50%."
                }
            },
            "Quiz_Module_3": {
                "moduleName": "Clinical Signs",
                "questionBank": [
                    {
                        "topic": "CullensSign",
                        "question": "Periumbilical ecchymosis (bruising around the umbilicus) is known as what clinical sign?",
                        "options": ["Turner's Sign", "Chvostek's Sign", "Cullen's Sign", "Trousseau's Sign"],
                        "correctAnswer": 2
                    }
                ],
                "topicTextMap": {
                    "CullensSign": "Cullen's sign is superficial edema and bruising in the subcutaneous fatty tissue around the umbilicus. It is a sign of retroperitoneal hemorrhage, often associated with acute pancreatitis."
                }
            }
        };


        // --- NO NEED TO EDIT BELOW THIS LINE ---

        document.addEventListener('DOMContentLoaded', () => {
            const views = {
                moduleSelection: document.getElementById('module-selection-view'),
                activeQuiz: document.getElementById('active-quiz-view'),
                quizSummary: document.getElementById('quiz-summary-view'),
            };

            const elements = {
                moduleSelectionForm: document.getElementById('module-selection-form'),
                startQuizBtn: document.getElementById('start-quiz-btn'),
                quizProgress: document.getElementById('quiz-progress'),
                questionText: document.getElementById('question-text'),
                answerOptions: document.getElementById('answer-options'),
                explanationText: document.getElementById('explanation-text'),
                skipQuestionBtn: document.getElementById('skip-question-btn'),
                exitQuizBtn: document.getElementById('exit-quiz-btn'),
                finalScore: document.getElementById('final-score'),
                returnToMenuBtn: document.getElementById('return-to-menu-btn'),
            };

            let quizState = {
                questions: [],
                currentQuestionIndex: 0,
                score: 0,
            };

            const navigate = (targetView) => {
                Object.values(views).forEach(v => v.classList.remove('active'));
                if (views[targetView]) {
                    views[targetView].classList.add('active');
                }
            };
            
            const renderModuleSelection = () => {
                elements.moduleSelectionForm.innerHTML = '';
                Object.keys(quizData).forEach(key => {
                    const module = quizData[key];
                    const label = document.createElement('label');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = key;
                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(` ${module.moduleName}`));
                    elements.moduleSelectionForm.appendChild(label);
                });
                elements.startQuizBtn.disabled = true;
                navigate('moduleSelection');
            };

            const handleStartQuiz = () => {
                const selectedCheckboxes = elements.moduleSelectionForm.querySelectorAll('input[type="checkbox"]:checked');
                if (selectedCheckboxes.length === 0) return;
                
                let combinedQuestions = [];
                selectedCheckboxes.forEach(cb => {
                    const moduleKey = cb.value;
                    const questions = quizData[moduleKey].questionBank.map(q => ({...q, moduleKey}));
                    combinedQuestions = combinedQuestions.concat(questions);
                });
                
                for (let i = combinedQuestions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [combinedQuestions[i], combinedQuestions[j]] = [combinedQuestions[j], combinedQuestions[i]];
                }
                
                quizState = { questions, currentQuestionIndex: 0, score: 0 };
                navigate('activeQuiz');
                displayQuestion();
            };
            
            const displayQuestion = () => {
                if (quizState.currentQuestionIndex >= quizState.questions.length) {
                    displaySummary();
                    return;
                }

                const currentQ = quizState.questions[quizState.currentQuestionIndex];
                elements.quizProgress.textContent = `Question ${quizState.currentQuestionIndex + 1} of ${quizState.questions.length}`;
                elements.questionText.textContent = currentQ.question;
                elements.answerOptions.innerHTML = '';
                elements.explanationText.style.display = 'none';

                currentQ.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.textContent = option;
                    btn.classList.add('button', 'option-btn');
                    btn.addEventListener('click', () => handleAnswerSelection(index));
                    elements.answerOptions.appendChild(btn);
                });
                
                const oldNextBtn = document.getElementById('next-q-btn');
                if(oldNextBtn) oldNextBtn.remove();
            };
            
            const handleAnswerSelection = (selectedIndex) => {
                const currentQ = quizState.questions[quizState.currentQuestionIndex];
                const isCorrect = selectedIndex === currentQ.correctAnswer;
                if(isCorrect) quizState.score++;
                
                Array.from(elements.answerOptions.children).forEach((btn, index) => {
                    btn.disabled = true;
                    if(index === currentQ.correctAnswer) btn.classList.add('correct');
                    else if (index === selectedIndex) btn.classList.add('incorrect');
                });
                
                const explanation = quizData[currentQ.moduleKey].topicTextMap[currentQ.topic];
                elements.explanationText.innerHTML = `<p><strong>Explanation:</strong> ${explanation || "No explanation available."}</p>`;
                elements.explanationText.style.display = 'block';

                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'Next Question';
                nextBtn.id = 'next-q-btn';
                nextBtn.classList.add('button');
                nextBtn.onclick = () => {
                    quizState.currentQuestionIndex++;
                    displayQuestion();
                };
                elements.activeQuiz.querySelector('.button-group').appendChild(nextBtn);
            };
            
            const displaySummary = () => {
                navigate('quizSummary');
                elements.finalScore.textContent = `${quizState.score} / ${quizState.questions.length}`;
            };
            
            elements.moduleSelectionForm.addEventListener('change', () => {
                elements.startQuizBtn.disabled = !elements.moduleSelectionForm.querySelector('input:checked');
            });

            elements.startQuizBtn.addEventListener('click', handleStartQuiz);
            elements.skipQuestionBtn.addEventListener('click', () => {
                quizState.currentQuestionIndex++;
                displayQuestion();
            });

            const exit = () => {
                if (confirm('Are you sure you want to exit? Your current quiz progress will be lost.')) {
                    renderModuleSelection();
                }
            };
            elements.exitQuizBtn.addEventListener('click', exit);
            elements.returnToMenuBtn.addEventListener('click', renderModuleSelection);

            renderModuleSelection();
        });
    </script>
</body>
</html>
